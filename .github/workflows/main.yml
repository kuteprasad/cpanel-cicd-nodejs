on: 
  push:
    branches:
      - main

name: ğŸš€ Deploy Backend on Push

jobs:
  backend-deploy:
    name: ğŸ‰ Deploy Backend
    runs-on: ubuntu-latest
    environment: test01

    steps:
      - name: ğŸšš Get latest code
        uses: actions/checkout@v4

      - name: ğŸ“‚ Upload project via SCP
        run: |
          echo "$SSH_PRIVATE_KEY" > private_key.pem
          chmod 600 private_key.pem
          scp -r -i private_key.pem ./ sunshineiot@sunshineiot.in:/home/sunshineiot/cpanel-cicd-nodejs/

      - name: ğŸ” Restart server (PM2 or Node)
        run: |
          ssh -i private_key.pem sunshineiot@sunshineiot.in << 'EOF'
            cd /home/sunshineiot/cpanel-cicd-nodejs
            npm install --omit=dev
            pm2 restart index || node index.js &
          EOF

    env:
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

